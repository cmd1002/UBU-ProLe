options {
    BUILD_TOKEN_MANAGER=false;
    DEBUG_TOKEN_MANAGER=false;
}

PARSER_BEGIN(Compiler)

public class Compiler {
    public static void main(String args[]) throws java.io.FileNotFoundException {
        final Compiler compiler = initCompiler(args);

        try {
            compiler.program();
        } catch (TokenMgrError ex) {
            System.out.println("Token Manager caught an unexpected exception, exiting...");
            throw ex;
        }
    }

    static Compiler initCompiler(String args[]) throws java.io.FileNotFoundException {
        final SimpleCharStream charStream;
        if (args.length < 1) {
            charStream = new SimpleCharStream(System.in);
        } else {
            charStream = new SimpleCharStream(new java.io.FileInputStream(args[0]),0,0);
        }
        return new Compiler(charStream);
    }
}
PARSER_END(Compiler)

TOKEN_MGR_DECLS : {}

TOKEN : {
    <"\n">
|   <#NUMBER: (["0"-"9"])+>
|   <#ALPHA: ["a"-"z", "A"-"Z"]>
|   <#VARIABLE: (<ALPHA> | "_") (<ALPHA> | <NUMBER> | "_")*>
|   <#ASSIGMENT: "=" | "+=" | "-=" | "/=" | "*=">
}
SKIP : {
    <~[]>
}

void program() : {} {
    statement() (program2())?
}

void program2(): {} {
    ";" program()
}

void statement() : {} {
    primmary()
    | <VARIABLE_STATEMENT: <VARIABLE>> assigment() expression()
}

void assigment() : {} {
    <ASSIGMENT_ASSIGMENT: <ASSIGMENT>>
}

void primmary() : {} {
    "if" expression() "then" program()
    ("elsif" expression() "then" program())*
    ("else" program()) "end"
|   "unless" expression() "then" program() ("else" program())? "end"
|   "until" expression() "do" program() "end"
|   "while" expression() "do" program() "end"
|   "print" expression()
}

void expression() : {} {
    mexpression() (expression2())?
}

void expression2() : {} {
    ("+" | "-") mexpression() expression2()
}

void mexpression() : {} {
    value() mexpression2()
}

void mexpression2() : {} {
    ("*" | "/") value() mexpression2()
}

void value() : {} {
    <VALUE_NUMBER: <NUMBER>>
|   <VALUE_VARIABLE: <VARIABLE>>
|    "(" expression() ")"
}